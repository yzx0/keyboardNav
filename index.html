<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./style.css">
    <title>导航</title>
</head>

<body>
    <header></header>
    <main>
        <div class="vessel" id="vessel">

        </div>
    </main>
    <footer></footer>
    <script>
        //初始化数据
        key = {
            0: { 0: 'q', 1: 'w', 2: 'e', 3: 'r', 4: 't', 5: 'y', 6: 'u', 7: 'i', 8: 'o', 9: 'p', length: '10' },
            1: { 0: 'a', 1: 's', 2: 'd', 3: 'f', 4: 'g', 5: 'h', 6: 'j', 7: 'k', 8: 'l', length: '9' },
            2: { 0: 'z', 1: 'x', 2: 'c', 3: 'v', 4: 'b', 5: 'n', 6: 'm', length: '7' },
            length: '3'
        }
        hash = {
            'q': 'qq.com',
            'w': 'weibo.com',
            'e': 'ele.me',
            'r': 'renren.com',
            't': 'tmall.com',
            'y': 'youtube.com',
            'u': 'uc.com',
            'i': 'iqiyi.com',
            'o': 'opera.com',
            'p': 'undefined',
            'a': 'acfun.com',
            'z': 'zhihu.com',
            'm': 'www.mcdonalds.com'
        }
        hashLocalStorage = getFromLocalStorage('zzz')
        if (localStorage) {
            hash = hashLocalStorage
        }
        
        function getFromLocalStorage(name){
            return JSON.parse(localStorage.getItem(name) || 'null')
        }
        //生成键盘
        index = 0
        while (index < key['length']) {
            div1 = createTag('div',{className:'row',id:'row'})
            vessel.appendChild(div1)
            index2 = 0
            secondArr = key[index]
            while (index2 < secondArr['length']) {
                
                myKeyboard = createTag('kbd')
                div1.appendChild(myKeyboard)

                span = document.createElement('span',{textContent:'secondArr[index2]'})
                
                myKeyboard.appendChild(span)

                editButton = document.createElement('button')
                editButton.textContent = 'E'
                editButton.id = secondArr[index2]
                myKeyboard.appendChild(editButton)

                myImg = createTag('img')
                if(hash[secondArr[index2]]){
                    myImg.src = 'http://' + hash[secondArr[index2]] + '/favicon.ico'
                }
                else{
                    myImg.src = './img/none.png'
                }
                myImg.onerror = function(imgInfo){
                    imgInfo.target.src = './img/none.png'
                    console.log('error')
                }
                myKeyboard.appendChild(myImg)

                editButton.onclick = function (buttonInfo) {
                    button = buttonInfo.target
                    buttonId = buttonInfo.target.id
                    newWebSite = prompt('请输入新的地址')
                    hash[buttonId] = newWebSite
                    img2 = button.nextSibling
                    img2.src = 'http://' + newWebSite + '/favicon.ico'
                    localStorage.setItem('zzz', JSON.stringify(hash))
                }
                index2++
            }
            index++
        }

        //监听用户键盘输入
        document.onkeypress = function (buttonInfo) {
            website = hash[buttonInfo.key]
            window.open('http://' + website, '_blank')
    
        }   

        //创建标签
        function createTag(tagName,attributes){
            var element = document.createElement(tagName)
            for(var key in attributes){    //key是名为attributes的哈希的key。className ：xxx
                element[key] = attributes[key]
            }
            return element
        }
    </script>
</body>

</html>